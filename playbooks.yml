---
- name: Tailscale Playbook
  hosts: "{{ host }}"
  become: true
  become_user: root
  serial: "{{ serial_hosts | default(1) }}"
  roles:
    - tailscale
  tags:
    - tailscale

- name: OS Playbook
  hosts: "{{ host }}"
  become: true
  become_user: root
  serial: "{{ serial_hosts | default(1) }}"
  roles:
    - os
  tags:
    - os

- name: Retrieve OP items
  hosts: localhost
  roles:
    - op
  tags:
    - op

- name: Provider Playbook
  hosts: "{{ host }}" # The target should be usually on a node where kubectl talks to the API server.
  become: true
  become_user: root
  serial: "{{ serial_hosts | default(1) }}"
  roles:
    - provider
  tags:
    - provider

- name: GPU Playbook
  hosts: "{{ host }}"
  become: true
  become_user: root
  serial: "{{ serial_hosts | default(1) }}"
  roles:
    - gpu
  tags:
    - gpu
