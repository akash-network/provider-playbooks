This ansible role covers the steps required for the installation of the GPU drivers.

### Prerequisites
- Host with GPUs
- Access to Kubernetes Cluster
- Kubectl binary
- Helm binary
- Jq binary

### Install the requirements
We need to install the Kubernetes core module specified in the requirements.yml file
```
sudo apt install python3-kubernetes
ansible-galaxy install -r requirements.yml
```

### Running the playbook
```
ansible-playbook playbooks.yaml -e 'host=target' -i inv -v
```

### Configuration Variables
| Variable                 | Description                                                      | Required | Default                |
|--------------------------|------------------------------------------------------------------|----------|------------------------|
| `install_dir`            | usually /root/<dir>, can be any directory - used to store files  | Yes      | /root/ansible.tmp      |
| `nvidia_version`         | Nvidia Driver Version                                            | Yes      | 565.57.01              |
| `gpu_nodes`              | list of nodes- used to apply the gpu labels                      | Yes      | [node1]                |



### Examples
#### Deployment

```
ansible-playbook playbooks.yaml -e 'host=target' -i inv -v
No config file found; using defaults

PLAY [GPU Playbook] ************************************************************************************************************

TASK [Gathering Facts] *********************************************************************************************************
[WARNING]: Platform linux on host server1 is using the discovered Python interpreter at /usr/bin/python3.12, but future
installation of another Python interpreter could change the meaning of that path. See https://docs.ansible.com/ansible-
core/2.17/reference_appendices/interpreter_discovery.html for more information.
ok: [server1]

TASK [gpu : Get OS Version] ****************************************************************************************************
ok: [server1] => {"ansible_facts": {"ubuntu_version": "2404"}, "changed": false}

TASK [gpu : Update the apt package index] **************************************************************************************
changed: [server1] => {"cache_update_time": 1740673085, "cache_updated": true, "changed": true}

TASK [gpu : Perform dist-upgrade with DEBIAN_FRONTEND noninteractive] **********************************************************
ok: [server1] => {"changed": false, "msg": "Reading package lists...\nBuilding dependency tree...\nReading state information...\nCalculating upgrade...\nThe following upgrades have been deferred due to phasing:\n  dmeventd dmsetup dracut-install initramfs-tools initramfs-tools-bin\n  initramfs-tools-core libdevmapper-event1.02.1 libdevmapper1.02.1 libfwupd2\n  liblvm2cmd2.03 lvm2 pollinate qemu-guest-agent\n0 upgraded, 0 newly installed, 0 to remove and 13 not upgraded.\n", "stderr": "", "stderr_lines": [], "stdout": "Reading package lists...\nBuilding dependency tree...\nReading state information...\nCalculating upgrade...\nThe following upgrades have been deferred due to phasing:\n  dmeventd dmsetup dracut-install initramfs-tools initramfs-tools-bin\n  initramfs-tools-core libdevmapper-event1.02.1 libdevmapper1.02.1 libfwupd2\n  liblvm2cmd2.03 lvm2 pollinate qemu-guest-agent\n0 upgraded, 0 newly installed, 0 to remove and 13 not upgraded.\n", "stdout_lines": ["Reading package lists...", "Building dependency tree...", "Reading state information...", "Calculating upgrade...", "The following upgrades have been deferred due to phasing:", "  dmeventd dmsetup dracut-install initramfs-tools initramfs-tools-bin", "  initramfs-tools-core libdevmapper-event1.02.1 libdevmapper1.02.1 libfwupd2", "  liblvm2cmd2.03 lvm2 pollinate qemu-guest-agent", "0 upgraded, 0 newly installed, 0 to remove and 13 not upgraded."]}

TASK [gpu : Remove unused packages] ********************************************************************************************
ok: [server1] => {"changed": false, "stderr": "", "stderr_lines": [], "stdout": "Reading package lists...\nBuilding dependency tree...\nReading state information...\n0 upgraded, 0 newly installed, 0 to remove and 13 not upgraded.\n", "stdout_lines": ["Reading package lists...", "Building dependency tree...", "Reading state information...", "0 upgraded, 0 newly installed, 0 to remove and 13 not upgraded."]}

TASK [gpu : Split NVIDIA version into components] ******************************************************************************
ok: [server1] => {"ansible_facts": {"nvidia_base_version": "565.57", "nvidia_major_version": "565", "nvidia_minor_version": "57", "nvidia_patch_version": "01"}, "changed": false}

TASK [gpu : Check if nvidia-smi is already installed] **************************************************************************
ok: [server1] => {"changed": false, "cmd": "nvidia-smi --query-gpu=driver_version --format=csv,noheader | head -n1", "delta": "0:00:00.004181", "end": "2025-02-27 16:18:30.464143", "msg": "", "rc": 0, "start": "2025-02-27 16:18:30.459962", "stderr": "/bin/sh: 1: nvidia-smi: not found", "stderr_lines": ["/bin/sh: 1: nvidia-smi: not found"], "stdout": "", "stdout_lines": []}

TASK [gpu : Set fact for current driver version] *******************************************************************************
ok: [server1] => {"ansible_facts": {"current_driver_version": ""}, "changed": false}

TASK [gpu : Fail if driver is already at the required version] *****************************************************************
skipping: [server1] => {"changed": false, "false_condition": "current_driver_version == nvidia_version", "skip_reason": "Conditional result was False"}

TASK [gpu : Add NVIDIA GPG key] ************************************************************************************************
ok: [server1] => {"before": ["A4B469963BF863CC", "DDCAE044F796ECB0", "D94AA3F0EFE21092", "871920D1991BC93C"], "changed": false, "fp": "DDCAE044F796ECB0", "id": "DDCAE044F796ECB0", "key_id": "DDCAE044F796ECB0", "short_id": "F796ECB0"}

TASK [gpu : Add NVIDIA repository] *********************************************************************************************
ok: [server1] => {"changed": false, "dest": "/etc/apt/sources.list.d/libnvidia-container.list", "elapsed": 0, "gid": 0, "group": "root", "mode": "0644", "msg": "HTTP Error 304: Not Modified", "owner": "root", "size": 147, "state": "file", "status_code": 304, "uid": 0, "url": "https://nvidia.github.io/libnvidia-container/stable/deb/nvidia-container-toolkit.list"}

TASK [gpu : Download NVIDIA GPG key] *******************************************************************************************
ok: [server1] => {"changed": false, "dest": "/tmp/3bf863cc.pub", "elapsed": 0, "gid": 0, "group": "root", "mode": "0644", "msg": "HTTP Error 304: Not Modified", "owner": "root", "size": 1650, "state": "file", "status_code": 304, "uid": 0, "url": "https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2404/x86_64/3bf863cc.pub"}

TASK [gpu : Add NVIDIA GPG key] ************************************************************************************************
ok: [server1] => {"before": ["A4B469963BF863CC", "DDCAE044F796ECB0", "D94AA3F0EFE21092", "871920D1991BC93C"], "changed": false, "fp": "A4B469963BF863CC", "id": "A4B469963BF863CC", "key_id": "A4B469963BF863CC", "short_id": "3BF863CC"}

TASK [gpu : Add NVIDIA repository] *********************************************************************************************
ok: [server1] => {"changed": false, "repo": "deb https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2404/x86_64/ /", "sources_added": [], "sources_removed": [], "state": "present"}

TASK [gpu : Update apt cache] **************************************************************************************************
changed: [server1] => {"cache_update_time": 1740673157, "cache_updated": true, "changed": true}

TASK [gpu : Install NVIDIA driver and autoremove unused packages] **************************************************************
changed: [server1] => {"cache_update_time": 1740673157, "cache_updated": false, "changed": true, "stderr": "", "stderr_lines": [], "stdout": "Reading package lists...\nBuilding dependency tree...\nReading state information...\nThe following additional packages will be installed:\n  libfontenc1 libgail-common libgail18t64 libgtk2.0-0t64 libgtk2.0-bin\n  libgtk2.0-common libnvidia-cfg1-565 libnvidia-common-565\n  libnvidia-compute-565 libnvidia-decode-565 libnvidia-encode-565\n  libnvidia-extra-565 libnvidia-fbc1-565 libnvidia-gl-565 libpkgconf3\n  libvdpau1 libxcvt0 libxfont2 libxnvctrl0 mesa-vdpau-drivers\n  nvidia-compute-utils-565 nvidia-dkms-565 nvidia-firmware-565-565.57.01\n  nvidia-kernel-common-565 nvidia-kernel-source-565 nvidia-modprobe\n  nvidia-prime nvidia-settings nvidia-utils-565 pkg-config pkgconf pkgconf-bin\n  python3-xkit screen-resolution-extra vdpau-driver-all x11-xkb-utils xcvt\n  xfonts-base xfonts-encodings xfonts-utils xserver-common xserver-xorg-core\n  xserver-xorg-video-nvidia-565\nSuggested packages:\n  gvfs libvdpau-va-gl1 xfs | xserver xfonts-100dpi | xfonts-75dpi\n  xfonts-scalable\nRecommended packages:\n  libnvidia-compute-565:i386 libnvidia-decode-565:i386\n  libnvidia-encode-565:i386 libnvidia-fbc1-565:i386 libnvidia-gl-565:i386\nThe following NEW packages will be installed:\n  libfontenc1 libgail-common libgail18t64 libgtk2.0-0t64 libgtk2.0-bin\n  libgtk2.0-common libnvidia-cfg1-565 libnvidia-common-565\n  libnvidia-compute-565 libnvidia-decode-565 libnvidia-encode-565\n  libnvidia-extra-565 libnvidia-fbc1-565 libnvidia-gl-565 libpkgconf3\n  libvdpau1 libxcvt0 libxfont2 libxnvctrl0 mesa-vdpau-drivers\n  nvidia-compute-utils-565 nvidia-dkms-565 nvidia-driver-565\n  nvidia-firmware-565-565.57.01 nvidia-kernel-common-565\n  nvidia-kernel-source-565 nvidia-modprobe nvidia-prime nvidia-settings\n  nvidia-utils-565 pkg-config pkgconf pkgconf-bin python3-xkit\n  screen-resolution-extra vdpau-driver-all x11-xkb-utils xcvt xfonts-base\n  xfonts-encodings xfonts-utils xserver-common xserver-xorg-core\n  xserver-xorg-video-nvidia-565\n0 upgraded, 44 newly installed, 0 to remove and 13 not upgraded.\nNeed to get 0 B/314 MB of archives.\nAfter this operation, 881 MB of additional disk space will be used.\nSelecting previously unselected package libfontenc1:amd64.\r\n(Reading database ... \r(Reading database ... 5%\r(Reading database ... 10%\r(Reading database ... 15%\r(Reading database ... 20%\r(Reading database ... 25%\r(Reading database ... 30%\r(Reading database ... 35%\r(Reading database ... 40%\r(Reading database ... 45%\r(Reading database ... 50%\r(Reading database ... 55%\r(Reading database ... 60%\r(Reading database ... 65%\r(Reading database ... 70%\r(Reading database ... 75%\r(Reading database ... 80%\r(Reading database ... 85%\r(Reading database ... 90%\r(Reading database ... 95%\r(Reading database ... 100%\r(Reading database ... 195650 files and directories currently installed.)\r\nPreparing to unpack .../00-libfontenc1_1%3a1.1.8-1build1_amd64.deb ...\r\nUnpacking libfontenc1:amd64 (1:1.1.8-1build1) ...\r\nSelecting previously unselected package libgtk2.0-common.\r\nPreparing to unpack .../01-libgtk2.0-common_2.24.33-4ubuntu1.1_all.deb ...\r\nUnpacking libgtk2.0-common (2.24.33-4ubuntu1.1) ...\r\nSelecting previously unselected package libgtk2.0-0t64:amd64.\r\nPreparing to unpack .../02-libgtk2.0-0t64_2.24.33-4ubuntu1.1_amd64.deb ...\r\nUnpacking libgtk2.0-0t64:amd64 (2.24.33-4ubuntu1.1) ...\r\nSelecting previously unselected package libgail18t64:amd64.\r\nPreparing to unpack .../03-libgail18t64_2.24.33-4ubuntu1.1_amd64.deb ...\r\nUnpacking libgail18t64:amd64 (2.24.33-4ubuntu1.1) ...\r\nSelecting previously unselected package libgail-common:amd64.\r\nPreparing to unpack .../04-libgail-common_2.24.33-4ubuntu1.1_amd64.deb ...\r\nUnpacking libgail-common:amd64 (2.24.33-4ubuntu1.1) ...\r\nSelecting previously unselected package libgtk2.0-bin.\r\nPreparing to unpack .../05-libgtk2.0-bin_2.24.33-4ubuntu1.1_amd64.deb ...\r\nUnpacking libgtk2.0-bin (2.24.33-4ubuntu1.1) ...\r\nSelecting previously unselected package libnvidia-cfg1-565:amd64.\r\nPreparing to unpack .../06-libnvidia-cfg1-565_565.57.01-0ubuntu1_amd64.deb ...\r\nUnpacking libnvidia-cfg1-565:amd64 (565.57.01-0ubuntu1) ...\r\nSelecting previously unselected package libnvidia-common-565.\r\nPreparing to unpack .../07-libnvidia-common-565_565.57.01-0ubuntu1_all.deb ...\r\nUnpacking libnvidia-common-565 (565.57.01-0ubuntu1) ...\r\nSelecting previously unselected package libnvidia-decode-565:amd64.\r\nPreparing to unpack .../08-libnvidia-decode-565_565.57.01-0ubuntu1_amd64.deb ...\r\nUnpacking libnvidia-decode-565:amd64 (565.57.01-0ubuntu1) ...\r\nSelecting previously unselected package libnvidia-compute-565:amd64.\r\nPreparing to unpack .../09-libnvidia-compute-565_565.57.01-0ubuntu1_amd64.deb ...\r\nUnpacking libnvidia-compute-565:amd64 (565.57.01-0ubuntu1) ...\r\nSelecting previously unselected package libnvidia-encode-565:amd64.\r\nPreparing to unpack .../10-libnvidia-encode-565_565.57.01-0ubuntu1_amd64.deb ...\r\nUnpacking libnvidia-encode-565:amd64 (565.57.01-0ubuntu1) ...\r\nSelecting previously unselected package libnvidia-extra-565:amd64.\r\nPreparing to unpack .../11-libnvidia-extra-565_565.57.01-0ubuntu1_amd64.deb ...\r\nUnpacking libnvidia-extra-565:amd64 (565.57.01-0ubuntu1) ...\r\nSelecting previously unselected package libnvidia-fbc1-565:amd64.\r\nPreparing to unpack .../12-libnvidia-fbc1-565_565.57.01-0ubuntu1_amd64.deb ...\r\nUnpacking libnvidia-fbc1-565:amd64 (565.57.01-0ubuntu1) ...\r\nSelecting previously unselected package libnvidia-gl-565:amd64.\r\nPreparing to unpack .../13-libnvidia-gl-565_565.57.01-0ubuntu1_amd64.deb ...\r\ndpkg-query: no packages found matching libnvidia-gl-535\r\nUnpacking libnvidia-gl-565:amd64 (565.57.01-0ubuntu1) ...\r\nSelecting previously unselected package libpkgconf3:amd64.\r\nPreparing to unpack .../14-libpkgconf3_1.8.1-2build1_amd64.deb ...\r\nUnpacking libpkgconf3:amd64 (1.8.1-2build1) ...\r\nSelecting previously unselected package libvdpau1:amd64.\r\nPreparing to unpack .../15-libvdpau1_1.5-2build1_amd64.deb ...\r\nUnpacking libvdpau1:amd64 (1.5-2build1) ...\r\nSelecting previously unselected package libxcvt0:amd64.\r\nPreparing to unpack .../16-libxcvt0_0.1.2-1build1_amd64.deb ...\r\nUnpacking libxcvt0:amd64 (0.1.2-1build1) ...\r\nSelecting previously unselected package libxfont2:amd64.\r\nPreparing to unpack .../17-libxfont2_1%3a2.0.6-1build1_amd64.deb ...\r\nUnpacking libxfont2:amd64 (1:2.0.6-1build1) ...\r\nSelecting previously unselected package libxnvctrl0:amd64.\r\nPreparing to unpack .../18-libxnvctrl0_570.86.15-0ubuntu1_amd64.deb ...\r\nUnpacking libxnvctrl0:amd64 (570.86.15-0ubuntu1) ...\r\nSelecting previously unselected package mesa-vdpau-drivers:amd64.\r\nPreparing to unpack .../19-mesa-vdpau-drivers_24.2.8-1ubuntu1~24.04.1_amd64.deb ...\r\nUnpacking mesa-vdpau-drivers:amd64 (24.2.8-1ubuntu1~24.04.1) ...\r\nSelecting previously unselected package nvidia-compute-utils-565.\r\nPreparing to unpack .../20-nvidia-compute-utils-565_565.57.01-0ubuntu1_amd64.deb ...\r\nUnpacking nvidia-compute-utils-565 (565.57.01-0ubuntu1) ...\r\nSelecting previously unselected package nvidia-kernel-source-565.\r\nPreparing to unpack .../21-nvidia-kernel-source-565_565.57.01-0ubuntu1_amd64.deb ...\r\nUnpacking nvidia-kernel-source-565 (565.57.01-0ubuntu1) ...\r\nSelecting previously unselected package nvidia-firmware-565-565.57.01.\r\nPreparing to unpack .../22-nvidia-firmware-565-565.57.01_565.57.01-0ubuntu1_amd64.deb ...\r\nUnpacking nvidia-firmware-565-565.57.01 (565.57.01-0ubuntu1) ...\r\nSelecting previously unselected package nvidia-modprobe.\r\nPreparing to unpack .../23-nvidia-modprobe_570.86.15-0ubuntu1_amd64.deb ...\r\nUnpacking nvidia-modprobe (570.86.15-0ubuntu1) ...\r\nSelecting previously unselected package nvidia-kernel-common-565.\r\nPreparing to unpack .../24-nvidia-kernel-common-565_565.57.01-0ubuntu1_amd64.deb ...\r\nUnpacking nvidia-kernel-common-565 (565.57.01-0ubuntu1) ...\r\nSelecting previously unselected package nvidia-dkms-565.\r\nPreparing to unpack .../25-nvidia-dkms-565_565.57.01-0ubuntu1_amd64.deb ...\r\nUnpacking nvidia-dkms-565 (565.57.01-0ubuntu1) ...\r\nSelecting previously unselected package nvidia-utils-565.\r\nPreparing to unpack .../26-nvidia-utils-565_565.57.01-0ubuntu1_amd64.deb ...\r\nUnpacking nvidia-utils-565 (565.57.01-0ubuntu1) ...\r\nSelecting previously unselected package x11-xkb-utils.\r\nPreparing to unpack .../27-x11-xkb-utils_7.7+8build2_amd64.deb ...\r\nUnpacking x11-xkb-utils (7.7+8build2) ...\r\nSelecting previously unselected package xserver-common.\r\nPreparing to unpack .../28-xserver-common_2%3a21.1.12-1ubuntu1.2_all.deb ...\r\nUnpacking xserver-common (2:21.1.12-1ubuntu1.2) ...\r\nSelecting previously unselected package xserver-xorg-core.\r\nPreparing to unpack .../29-xserver-xorg-core_2%3a21.1.12-1ubuntu1.2_amd64.deb ...\r\nUnpacking xserver-xorg-core (2:21.1.12-1ubuntu1.2) ...\r\nSelecting previously unselected package xserver-xorg-video-nvidia-565.\r\nPreparing to unpack .../30-xserver-xorg-video-nvidia-565_565.57.01-0ubuntu1_amd64.deb ...\r\nUnpacking xserver-xorg-video-nvidia-565 (565.57.01-0ubuntu1) ...\r\nSelecting previously unselected package nvidia-driver-565.\r\nPreparing to unpack .../31-nvidia-driver-565_565.57.01-0ubuntu1_amd64.deb ...\r\nUnpacking nvidia-driver-565 (565.57.01-0ubuntu1) ...\r\nSelecting previously unselected package nvidia-prime.\r\nPreparing to unpack .../32-nvidia-prime_0.8.17.2_all.deb ...\r\nUnpacking nvidia-prime (0.8.17.2) ...\r\nSelecting previously unselected package pkgconf-bin.\r\nPreparing to unpack .../33-pkgconf-bin_1.8.1-2build1_amd64.deb ...\r\nUnpacking pkgconf-bin (1.8.1-2build1) ...\r\nSelecting previously unselected package pkgconf:amd64.\r\nPreparing to unpack .../34-pkgconf_1.8.1-2build1_amd64.deb ...\r\nUnpacking pkgconf:amd64 (1.8.1-2build1) ...\r\nSelecting previously unselected package pkg-config:amd64.\r\nPreparing to unpack .../35-pkg-config_1.8.1-2build1_amd64.deb ...\r\nUnpacking pkg-config:amd64 (1.8.1-2build1) ...\r\nSelecting previously unselected package python3-xkit.\r\nPreparing to unpack .../36-python3-xkit_0.5.0ubuntu6_all.deb ...\r\nUnpacking python3-xkit (0.5.0ubuntu6) ...\r\nSelecting previously unselected package screen-resolution-extra.\r\nPreparing to unpack .../37-screen-resolution-extra_0.18.3_all.deb ...\r\nUnpacking screen-resolution-extra (0.18.3) ...\r\nSelecting previously unselected package nvidia-settings.\r\nPreparing to unpack .../38-nvidia-settings_570.86.15-0ubuntu1_amd64.deb ...\r\nUnpacking nvidia-settings (570.86.15-0ubuntu1) ...\r\nSelecting previously unselected package vdpau-driver-all:amd64.\r\nPreparing to unpack .../39-vdpau-driver-all_1.5-2build1_amd64.deb ...\r\nUnpacking vdpau-driver-all:amd64 (1.5-2build1) ...\r\nSelecting previously unselected package xcvt.\r\nPreparing to unpack .../40-xcvt_0.1.2-1build1_amd64.deb ...\r\nUnpacking xcvt (0.1.2-1build1) ...\r\nSelecting previously unselected package xfonts-encodings.\r\nPreparing to unpack .../41-xfonts-encodings_1%3a1.0.5-0ubuntu2_all.deb ...\r\nUnpacking xfonts-encodings (1:1.0.5-0ubuntu2) ...\r\nSelecting previously unselected package xfonts-utils.\r\nPreparing to unpack .../42-xfonts-utils_1%3a7.7+6build3_amd64.deb ...\r\nUnpacking xfonts-utils (1:7.7+6build3) ...\r\nSelecting previously unselected package xfonts-base.\r\nPreparing to unpack .../43-xfonts-base_1%3a1.0.5+nmu1_all.deb ...\r\nUnpacking xfonts-base (1:1.0.5+nmu1) ...\r\nSetting up libnvidia-common-565 (565.57.01-0ubuntu1) ...\r\nSetting up libnvidia-cfg1-565:amd64 (565.57.01-0ubuntu1) ...\r\nSetting up nvidia-prime (0.8.17.2) ...\r\nSetting up x11-xkb-utils (7.7+8build2) ...\r\nSetting up nvidia-kernel-source-565 (565.57.01-0ubuntu1) ...\r\nSetting up nvidia-firmware-565-565.57.01 (565.57.01-0ubuntu1) ...\r\nSetting up libnvidia-fbc1-565:amd64 (565.57.01-0ubuntu1) ...\r\nSetting up libnvidia-extra-565:amd64 (565.57.01-0ubuntu1) ...\r\nSetting up nvidia-modprobe (570.86.15-0ubuntu1) ...\r\nSetting up libxnvctrl0:amd64 (570.86.15-0ubuntu1) ...\r\nSetting up libfontenc1:amd64 (1:1.1.8-1build1) ...\r\nSetting up libpkgconf3:amd64 (1.8.1-2build1) ...\r\nSetting up xfonts-encodings (1:1.0.5-0ubuntu2) ...\r\nSetting up pkgconf-bin (1.8.1-2build1) ...\r\nSetting up nvidia-kernel-common-565 (565.57.01-0ubuntu1) ...\r\nupdate-initramfs: deferring update (trigger activated)\r\nCreated symlink /etc/systemd/system/systemd-hibernate.service.wants/nvidia-hibernate.service → /usr/lib/systemd/system/nvidia-hibernate.service.\r\r\nCreated symlink /etc/systemd/system/systemd-suspend.service.wants/nvidia-resume.service → /usr/lib/systemd/system/nvidia-resume.service.\r\r\nCreated symlink /etc/systemd/system/systemd-hibernate.service.wants/nvidia-resume.service → /usr/lib/systemd/system/nvidia-resume.service.\r\r\nCreated symlink /etc/systemd/system/systemd-suspend.service.wants/nvidia-suspend.service → /usr/lib/systemd/system/nvidia-suspend.service.\r\r\nSetting up libvdpau1:amd64 (1.5-2build1) ...\r\nSetting up libxcvt0:amd64 (0.1.2-1build1) ...\r\nSetting up libgtk2.0-common (2.24.33-4ubuntu1.1) ...\r\nSetting up xserver-common (2:21.1.12-1ubuntu1.2) ...\r\nSetting up python3-xkit (0.5.0ubuntu6) ...\r\nSetting up libxfont2:amd64 (1:2.0.6-1build1) ...\r\nSetting up mesa-vdpau-drivers:amd64 (24.2.8-1ubuntu1~24.04.1) ...\r\nSetting up xserver-xorg-core (2:21.1.12-1ubuntu1.2) ...\r\nSetting up xfonts-utils (1:7.7+6build3) ...\r\nSetting up pkgconf:amd64 (1.8.1-2build1) ...\r\nSetting up xcvt (0.1.2-1build1) ...\r\nSetting up xfonts-base (1:1.0.5+nmu1) ...\r\nSetting up nvidia-dkms-565 (565.57.01-0ubuntu1) ...\r\nupdate-initramfs: deferring update (trigger activated)\r\nLoading new nvidia-565.57.01 DKMS files...\r\nBuilding for 6.8.0-54-generic\r\nBuilding for architecture x86_64\r\nBuilding initial module for 6.8.0-54-generic\r\nDone.\r\n\r\nnvidia.ko.zst:\r\nRunning module version sanity check.\r\n - Original module\r\n   - No original module exists within this kernel\r\n - Installation\r\n   - Installing to /lib/modules/6.8.0-54-generic/updates/dkms/\r\n\r\nnvidia-modeset.ko.zst:\r\nRunning module version sanity check.\r\n - Original module\r\n   - No original module exists within this kernel\r\n - Installation\r\n   - Installing to /lib/modules/6.8.0-54-generic/updates/dkms/\r\n\r\nnvidia-drm.ko.zst:\r\nRunning module version sanity check.\r\n - Original module\r\n   - No original module exists within this kernel\r\n - Installation\r\n   - Installing to /lib/modules/6.8.0-54-generic/updates/dkms/\r\n\r\nnvidia-uvm.ko.zst:\r\nRunning module version sanity check.\r\n - Original module\r\n   - No original module exists within this kernel\r\n - Installation\r\n   - Installing to /lib/modules/6.8.0-54-generic/updates/dkms/\r\n\r\nnvidia-peermem.ko.zst:\r\nRunning module version sanity check.\r\n - Original module\r\n   - No original module exists within this kernel\r\n - Installation\r\n   - Installing to /lib/modules/6.8.0-54-generic/updates/dkms/\r\ndepmod...\r\nSetting up libgtk2.0-0t64:amd64 (2.24.33-4ubuntu1.1) ...\r\nSetting up pkg-config:amd64 (1.8.1-2build1) ...\r\nSetting up screen-resolution-extra (0.18.3) ...\r\nSetting up libgail18t64:amd64 (2.24.33-4ubuntu1.1) ...\r\nSetting up vdpau-driver-all:amd64 (1.5-2build1) ...\r\nSetting up libgtk2.0-bin (2.24.33-4ubuntu1.1) ...\r\nSetting up xserver-xorg-video-nvidia-565 (565.57.01-0ubuntu1) ...\r\nSetting up nvidia-settings (570.86.15-0ubuntu1) ...\r\nSetting up libgail-common:amd64 (2.24.33-4ubuntu1.1) ...\r\nSetting up libnvidia-compute-565:amd64 (565.57.01-0ubuntu1) ...\r\nSetting up libnvidia-gl-565:amd64 (565.57.01-0ubuntu1) ...\r\nSetting up nvidia-utils-565 (565.57.01-0ubuntu1) ...\r\nSetting up libnvidia-decode-565:amd64 (565.57.01-0ubuntu1) ...\r\nSetting up nvidia-compute-utils-565 (565.57.01-0ubuntu1) ...\r\nSetting up libnvidia-encode-565:amd64 (565.57.01-0ubuntu1) ...\r\nSetting up nvidia-driver-565 (565.57.01-0ubuntu1) ...\r\nProcessing triggers for fontconfig (2.15.0-1.1ubuntu2) ...\r\nProcessing triggers for initramfs-tools (0.142ubuntu25.4) ...\r\nupdate-initramfs: Generating /boot/initrd.img-6.8.0-54-generic\r\nProcessing triggers for libc-bin (2.39-0ubuntu8.4) ...\r\nProcessing triggers for man-db (2.12.0-4build2) ...\r\n\nRunning kernel seems to be up-to-date.\n\nNo services need to be restarted.\n\nNo containers need to be restarted.\n\nNo user sessions are running outdated binaries.\n\nNo VM guests are running outdated hypervisor (qemu) binaries on this host.\n", "stdout_lines": ["Reading package lists...", "Building dependency tree...", "Reading state information...", "The following additional packages will be installed:", "  libfontenc1 libgail-common libgail18t64 libgtk2.0-0t64 libgtk2.0-bin", "  libgtk2.0-common libnvidia-cfg1-565 libnvidia-common-565", "  libnvidia-compute-565 libnvidia-decode-565 libnvidia-encode-565", "  libnvidia-extra-565 libnvidia-fbc1-565 libnvidia-gl-565 libpkgconf3", "  libvdpau1 libxcvt0 libxfont2 libxnvctrl0 mesa-vdpau-drivers", "  nvidia-compute-utils-565 nvidia-dkms-565 nvidia-firmware-565-565.57.01", "  nvidia-kernel-common-565 nvidia-kernel-source-565 nvidia-modprobe", "  nvidia-prime nvidia-settings nvidia-utils-565 pkg-config pkgconf pkgconf-bin", "  python3-xkit screen-resolution-extra vdpau-driver-all x11-xkb-utils xcvt", "  xfonts-base xfonts-encodings xfonts-utils xserver-common xserver-xorg-core", "  xserver-xorg-video-nvidia-565", "Suggested packages:", "  gvfs libvdpau-va-gl1 xfs | xserver xfonts-100dpi | xfonts-75dpi", "  xfonts-scalable", "Recommended packages:", "  libnvidia-compute-565:i386 libnvidia-decode-565:i386", "  libnvidia-encode-565:i386 libnvidia-fbc1-565:i386 libnvidia-gl-565:i386", "The following NEW packages will be installed:", "  libfontenc1 libgail-common libgail18t64 libgtk2.0-0t64 libgtk2.0-bin", "  libgtk2.0-common libnvidia-cfg1-565 libnvidia-common-565", "  libnvidia-compute-565 libnvidia-decode-565 libnvidia-encode-565", "  libnvidia-extra-565 libnvidia-fbc1-565 libnvidia-gl-565 libpkgconf3", "  libvdpau1 libxcvt0 libxfont2 libxnvctrl0 mesa-vdpau-drivers", "  nvidia-compute-utils-565 nvidia-dkms-565 nvidia-driver-565", "  nvidia-firmware-565-565.57.01 nvidia-kernel-common-565", "  nvidia-kernel-source-565 nvidia-modprobe nvidia-prime nvidia-settings", "  nvidia-utils-565 pkg-config pkgconf pkgconf-bin python3-xkit", "  screen-resolution-extra vdpau-driver-all x11-xkb-utils xcvt xfonts-base", "  xfonts-encodings xfonts-utils xserver-common xserver-xorg-core", "  xserver-xorg-video-nvidia-565", "0 upgraded, 44 newly installed, 0 to remove and 13 not upgraded.", "Need to get 0 B/314 MB of archives.", "After this operation, 881 MB of additional disk space will be used.", "Selecting previously unselected package libfontenc1:amd64.", "(Reading database ... ", "(Reading database ... 5%", "(Reading database ... 10%", "(Reading database ... 15%", "(Reading database ... 20%", "(Reading database ... 25%", "(Reading database ... 30%", "(Reading database ... 35%", "(Reading database ... 40%", "(Reading database ... 45%", "(Reading database ... 50%", "(Reading database ... 55%", "(Reading database ... 60%", "(Reading database ... 65%", "(Reading database ... 70%", "(Reading database ... 75%", "(Reading database ... 80%", "(Reading database ... 85%", "(Reading database ... 90%", "(Reading database ... 95%", "(Reading database ... 100%", "(Reading database ... 195650 files and directories currently installed.)", "Preparing to unpack .../00-libfontenc1_1%3a1.1.8-1build1_amd64.deb ...", "Unpacking libfontenc1:amd64 (1:1.1.8-1build1) ...", "Selecting previously unselected package libgtk2.0-common.", "Preparing to unpack .../01-libgtk2.0-common_2.24.33-4ubuntu1.1_all.deb ...", "Unpacking libgtk2.0-common (2.24.33-4ubuntu1.1) ...", "Selecting previously unselected package libgtk2.0-0t64:amd64.", "Preparing to unpack .../02-libgtk2.0-0t64_2.24.33-4ubuntu1.1_amd64.deb ...", "Unpacking libgtk2.0-0t64:amd64 (2.24.33-4ubuntu1.1) ...", "Selecting previously unselected package libgail18t64:amd64.", "Preparing to unpack .../03-libgail18t64_2.24.33-4ubuntu1.1_amd64.deb ...", "Unpacking libgail18t64:amd64 (2.24.33-4ubuntu1.1) ...", "Selecting previously unselected package libgail-common:amd64.", "Preparing to unpack .../04-libgail-common_2.24.33-4ubuntu1.1_amd64.deb ...", "Unpacking libgail-common:amd64 (2.24.33-4ubuntu1.1) ...", "Selecting previously unselected package libgtk2.0-bin.", "Preparing to unpack .../05-libgtk2.0-bin_2.24.33-4ubuntu1.1_amd64.deb ...", "Unpacking libgtk2.0-bin (2.24.33-4ubuntu1.1) ...", "Selecting previously unselected package libnvidia-cfg1-565:amd64.", "Preparing to unpack .../06-libnvidia-cfg1-565_565.57.01-0ubuntu1_amd64.deb ...", "Unpacking libnvidia-cfg1-565:amd64 (565.57.01-0ubuntu1) ...", "Selecting previously unselected package libnvidia-common-565.", "Preparing to unpack .../07-libnvidia-common-565_565.57.01-0ubuntu1_all.deb ...", "Unpacking libnvidia-common-565 (565.57.01-0ubuntu1) ...", "Selecting previously unselected package libnvidia-decode-565:amd64.", "Preparing to unpack .../08-libnvidia-decode-565_565.57.01-0ubuntu1_amd64.deb ...", "Unpacking libnvidia-decode-565:amd64 (565.57.01-0ubuntu1) ...", "Selecting previously unselected package libnvidia-compute-565:amd64.", "Preparing to unpack .../09-libnvidia-compute-565_565.57.01-0ubuntu1_amd64.deb ...", "Unpacking libnvidia-compute-565:amd64 (565.57.01-0ubuntu1) ...", "Selecting previously unselected package libnvidia-encode-565:amd64.", "Preparing to unpack .../10-libnvidia-encode-565_565.57.01-0ubuntu1_amd64.deb ...", "Unpacking libnvidia-encode-565:amd64 (565.57.01-0ubuntu1) ...", "Selecting previously unselected package libnvidia-extra-565:amd64.", "Preparing to unpack .../11-libnvidia-extra-565_565.57.01-0ubuntu1_amd64.deb ...", "Unpacking libnvidia-extra-565:amd64 (565.57.01-0ubuntu1) ...", "Selecting previously unselected package libnvidia-fbc1-565:amd64.", "Preparing to unpack .../12-libnvidia-fbc1-565_565.57.01-0ubuntu1_amd64.deb ...", "Unpacking libnvidia-fbc1-565:amd64 (565.57.01-0ubuntu1) ...", "Selecting previously unselected package libnvidia-gl-565:amd64.", "Preparing to unpack .../13-libnvidia-gl-565_565.57.01-0ubuntu1_amd64.deb ...", "dpkg-query: no packages found matching libnvidia-gl-535", "Unpacking libnvidia-gl-565:amd64 (565.57.01-0ubuntu1) ...", "Selecting previously unselected package libpkgconf3:amd64.", "Preparing to unpack .../14-libpkgconf3_1.8.1-2build1_amd64.deb ...", "Unpacking libpkgconf3:amd64 (1.8.1-2build1) ...", "Selecting previously unselected package libvdpau1:amd64.", "Preparing to unpack .../15-libvdpau1_1.5-2build1_amd64.deb ...", "Unpacking libvdpau1:amd64 (1.5-2build1) ...", "Selecting previously unselected package libxcvt0:amd64.", "Preparing to unpack .../16-libxcvt0_0.1.2-1build1_amd64.deb ...", "Unpacking libxcvt0:amd64 (0.1.2-1build1) ...", "Selecting previously unselected package libxfont2:amd64.", "Preparing to unpack .../17-libxfont2_1%3a2.0.6-1build1_amd64.deb ...", "Unpacking libxfont2:amd64 (1:2.0.6-1build1) ...", "Selecting previously unselected package libxnvctrl0:amd64.", "Preparing to unpack .../18-libxnvctrl0_570.86.15-0ubuntu1_amd64.deb ...", "Unpacking libxnvctrl0:amd64 (570.86.15-0ubuntu1) ...", "Selecting previously unselected package mesa-vdpau-drivers:amd64.", "Preparing to unpack .../19-mesa-vdpau-drivers_24.2.8-1ubuntu1~24.04.1_amd64.deb ...", "Unpacking mesa-vdpau-drivers:amd64 (24.2.8-1ubuntu1~24.04.1) ...", "Selecting previously unselected package nvidia-compute-utils-565.", "Preparing to unpack .../20-nvidia-compute-utils-565_565.57.01-0ubuntu1_amd64.deb ...", "Unpacking nvidia-compute-utils-565 (565.57.01-0ubuntu1) ...", "Selecting previously unselected package nvidia-kernel-source-565.", "Preparing to unpack .../21-nvidia-kernel-source-565_565.57.01-0ubuntu1_amd64.deb ...", "Unpacking nvidia-kernel-source-565 (565.57.01-0ubuntu1) ...", "Selecting previously unselected package nvidia-firmware-565-565.57.01.", "Preparing to unpack .../22-nvidia-firmware-565-565.57.01_565.57.01-0ubuntu1_amd64.deb ...", "Unpacking nvidia-firmware-565-565.57.01 (565.57.01-0ubuntu1) ...", "Selecting previously unselected package nvidia-modprobe.", "Preparing to unpack .../23-nvidia-modprobe_570.86.15-0ubuntu1_amd64.deb ...", "Unpacking nvidia-modprobe (570.86.15-0ubuntu1) ...", "Selecting previously unselected package nvidia-kernel-common-565.", "Preparing to unpack .../24-nvidia-kernel-common-565_565.57.01-0ubuntu1_amd64.deb ...", "Unpacking nvidia-kernel-common-565 (565.57.01-0ubuntu1) ...", "Selecting previously unselected package nvidia-dkms-565.", "Preparing to unpack .../25-nvidia-dkms-565_565.57.01-0ubuntu1_amd64.deb ...", "Unpacking nvidia-dkms-565 (565.57.01-0ubuntu1) ...", "Selecting previously unselected package nvidia-utils-565.", "Preparing to unpack .../26-nvidia-utils-565_565.57.01-0ubuntu1_amd64.deb ...", "Unpacking nvidia-utils-565 (565.57.01-0ubuntu1) ...", "Selecting previously unselected package x11-xkb-utils.", "Preparing to unpack .../27-x11-xkb-utils_7.7+8build2_amd64.deb ...", "Unpacking x11-xkb-utils (7.7+8build2) ...", "Selecting previously unselected package xserver-common.", "Preparing to unpack .../28-xserver-common_2%3a21.1.12-1ubuntu1.2_all.deb ...", "Unpacking xserver-common (2:21.1.12-1ubuntu1.2) ...", "Selecting previously unselected package xserver-xorg-core.", "Preparing to unpack .../29-xserver-xorg-core_2%3a21.1.12-1ubuntu1.2_amd64.deb ...", "Unpacking xserver-xorg-core (2:21.1.12-1ubuntu1.2) ...", "Selecting previously unselected package xserver-xorg-video-nvidia-565.", "Preparing to unpack .../30-xserver-xorg-video-nvidia-565_565.57.01-0ubuntu1_amd64.deb ...", "Unpacking xserver-xorg-video-nvidia-565 (565.57.01-0ubuntu1) ...", "Selecting previously unselected package nvidia-driver-565.", "Preparing to unpack .../31-nvidia-driver-565_565.57.01-0ubuntu1_amd64.deb ...", "Unpacking nvidia-driver-565 (565.57.01-0ubuntu1) ...", "Selecting previously unselected package nvidia-prime.", "Preparing to unpack .../32-nvidia-prime_0.8.17.2_all.deb ...", "Unpacking nvidia-prime (0.8.17.2) ...", "Selecting previously unselected package pkgconf-bin.", "Preparing to unpack .../33-pkgconf-bin_1.8.1-2build1_amd64.deb ...", "Unpacking pkgconf-bin (1.8.1-2build1) ...", "Selecting previously unselected package pkgconf:amd64.", "Preparing to unpack .../34-pkgconf_1.8.1-2build1_amd64.deb ...", "Unpacking pkgconf:amd64 (1.8.1-2build1) ...", "Selecting previously unselected package pkg-config:amd64.", "Preparing to unpack .../35-pkg-config_1.8.1-2build1_amd64.deb ...", "Unpacking pkg-config:amd64 (1.8.1-2build1) ...", "Selecting previously unselected package python3-xkit.", "Preparing to unpack .../36-python3-xkit_0.5.0ubuntu6_all.deb ...", "Unpacking python3-xkit (0.5.0ubuntu6) ...", "Selecting previously unselected package screen-resolution-extra.", "Preparing to unpack .../37-screen-resolution-extra_0.18.3_all.deb ...", "Unpacking screen-resolution-extra (0.18.3) ...", "Selecting previously unselected package nvidia-settings.", "Preparing to unpack .../38-nvidia-settings_570.86.15-0ubuntu1_amd64.deb ...", "Unpacking nvidia-settings (570.86.15-0ubuntu1) ...", "Selecting previously unselected package vdpau-driver-all:amd64.", "Preparing to unpack .../39-vdpau-driver-all_1.5-2build1_amd64.deb ...", "Unpacking vdpau-driver-all:amd64 (1.5-2build1) ...", "Selecting previously unselected package xcvt.", "Preparing to unpack .../40-xcvt_0.1.2-1build1_amd64.deb ...", "Unpacking xcvt (0.1.2-1build1) ...", "Selecting previously unselected package xfonts-encodings.", "Preparing to unpack .../41-xfonts-encodings_1%3a1.0.5-0ubuntu2_all.deb ...", "Unpacking xfonts-encodings (1:1.0.5-0ubuntu2) ...", "Selecting previously unselected package xfonts-utils.", "Preparing to unpack .../42-xfonts-utils_1%3a7.7+6build3_amd64.deb ...", "Unpacking xfonts-utils (1:7.7+6build3) ...", "Selecting previously unselected package xfonts-base.", "Preparing to unpack .../43-xfonts-base_1%3a1.0.5+nmu1_all.deb ...", "Unpacking xfonts-base (1:1.0.5+nmu1) ...", "Setting up libnvidia-common-565 (565.57.01-0ubuntu1) ...", "Setting up libnvidia-cfg1-565:amd64 (565.57.01-0ubuntu1) ...", "Setting up nvidia-prime (0.8.17.2) ...", "Setting up x11-xkb-utils (7.7+8build2) ...", "Setting up nvidia-kernel-source-565 (565.57.01-0ubuntu1) ...", "Setting up nvidia-firmware-565-565.57.01 (565.57.01-0ubuntu1) ...", "Setting up libnvidia-fbc1-565:amd64 (565.57.01-0ubuntu1) ...", "Setting up libnvidia-extra-565:amd64 (565.57.01-0ubuntu1) ...", "Setting up nvidia-modprobe (570.86.15-0ubuntu1) ...", "Setting up libxnvctrl0:amd64 (570.86.15-0ubuntu1) ...", "Setting up libfontenc1:amd64 (1:1.1.8-1build1) ...", "Setting up libpkgconf3:amd64 (1.8.1-2build1) ...", "Setting up xfonts-encodings (1:1.0.5-0ubuntu2) ...", "Setting up pkgconf-bin (1.8.1-2build1) ...", "Setting up nvidia-kernel-common-565 (565.57.01-0ubuntu1) ...", "update-initramfs: deferring update (trigger activated)", "Created symlink /etc/systemd/system/systemd-hibernate.service.wants/nvidia-hibernate.service → /usr/lib/systemd/system/nvidia-hibernate.service.", "", "Created symlink /etc/systemd/system/systemd-suspend.service.wants/nvidia-resume.service → /usr/lib/systemd/system/nvidia-resume.service.", "", "Created symlink /etc/systemd/system/systemd-hibernate.service.wants/nvidia-resume.service → /usr/lib/systemd/system/nvidia-resume.service.", "", "Created symlink /etc/systemd/system/systemd-suspend.service.wants/nvidia-suspend.service → /usr/lib/systemd/system/nvidia-suspend.service.", "", "Setting up libvdpau1:amd64 (1.5-2build1) ...", "Setting up libxcvt0:amd64 (0.1.2-1build1) ...", "Setting up libgtk2.0-common (2.24.33-4ubuntu1.1) ...", "Setting up xserver-common (2:21.1.12-1ubuntu1.2) ...", "Setting up python3-xkit (0.5.0ubuntu6) ...", "Setting up libxfont2:amd64 (1:2.0.6-1build1) ...", "Setting up mesa-vdpau-drivers:amd64 (24.2.8-1ubuntu1~24.04.1) ...", "Setting up xserver-xorg-core (2:21.1.12-1ubuntu1.2) ...", "Setting up xfonts-utils (1:7.7+6build3) ...", "Setting up pkgconf:amd64 (1.8.1-2build1) ...", "Setting up xcvt (0.1.2-1build1) ...", "Setting up xfonts-base (1:1.0.5+nmu1) ...", "Setting up nvidia-dkms-565 (565.57.01-0ubuntu1) ...", "update-initramfs: deferring update (trigger activated)", "Loading new nvidia-565.57.01 DKMS files...", "Building for 6.8.0-54-generic", "Building for architecture x86_64", "Building initial module for 6.8.0-54-generic", "Done.", "", "nvidia.ko.zst:", "Running module version sanity check.", " - Original module", "   - No original module exists within this kernel", " - Installation", "   - Installing to /lib/modules/6.8.0-54-generic/updates/dkms/", "", "nvidia-modeset.ko.zst:", "Running module version sanity check.", " - Original module", "   - No original module exists within this kernel", " - Installation", "   - Installing to /lib/modules/6.8.0-54-generic/updates/dkms/", "", "nvidia-drm.ko.zst:", "Running module version sanity check.", " - Original module", "   - No original module exists within this kernel", " - Installation", "   - Installing to /lib/modules/6.8.0-54-generic/updates/dkms/", "", "nvidia-uvm.ko.zst:", "Running module version sanity check.", " - Original module", "   - No original module exists within this kernel", " - Installation", "   - Installing to /lib/modules/6.8.0-54-generic/updates/dkms/", "", "nvidia-peermem.ko.zst:", "Running module version sanity check.", " - Original module", "   - No original module exists within this kernel", " - Installation", "   - Installing to /lib/modules/6.8.0-54-generic/updates/dkms/", "depmod...", "Setting up libgtk2.0-0t64:amd64 (2.24.33-4ubuntu1.1) ...", "Setting up pkg-config:amd64 (1.8.1-2build1) ...", "Setting up screen-resolution-extra (0.18.3) ...", "Setting up libgail18t64:amd64 (2.24.33-4ubuntu1.1) ...", "Setting up vdpau-driver-all:amd64 (1.5-2build1) ...", "Setting up libgtk2.0-bin (2.24.33-4ubuntu1.1) ...", "Setting up xserver-xorg-video-nvidia-565 (565.57.01-0ubuntu1) ...", "Setting up nvidia-settings (570.86.15-0ubuntu1) ...", "Setting up libgail-common:amd64 (2.24.33-4ubuntu1.1) ...", "Setting up libnvidia-compute-565:amd64 (565.57.01-0ubuntu1) ...", "Setting up libnvidia-gl-565:amd64 (565.57.01-0ubuntu1) ...", "Setting up nvidia-utils-565 (565.57.01-0ubuntu1) ...", "Setting up libnvidia-decode-565:amd64 (565.57.01-0ubuntu1) ...", "Setting up nvidia-compute-utils-565 (565.57.01-0ubuntu1) ...", "Setting up libnvidia-encode-565:amd64 (565.57.01-0ubuntu1) ...", "Setting up nvidia-driver-565 (565.57.01-0ubuntu1) ...", "Processing triggers for fontconfig (2.15.0-1.1ubuntu2) ...", "Processing triggers for initramfs-tools (0.142ubuntu25.4) ...", "update-initramfs: Generating /boot/initrd.img-6.8.0-54-generic", "Processing triggers for libc-bin (2.39-0ubuntu8.4) ...", "Processing triggers for man-db (2.12.0-4build2) ...", "", "Running kernel seems to be up-to-date.", "", "No services need to be restarted.", "", "No containers need to be restarted.", "", "No user sessions are running outdated binaries.", "", "No VM guests are running outdated hypervisor (qemu) binaries on this host."]}

TASK [gpu : Unload all NVIDIA modules in reverse order] ************************************************************************
changed: [server1] => {"changed": true, "cmd": "set +e\nif lsmod | grep -q gdrdrv; then rmmod -f gdrdrv; fi\nif lsmod | grep -q nvidia_uvm; then rmmod -f nvidia_uvm; fi\nif lsmod | grep -q nvidia_drm; then rmmod -f nvidia_drm; fi\nif lsmod | grep -q nvidia_modeset; then rmmod -f nvidia_modeset; fi\nif lsmod | grep -q nvidia; then rmmod -f nvidia; fi\n", "delta": "0:00:00.452780", "end": "2025-02-27 16:20:45.266316", "msg": "", "rc": 0, "start": "2025-02-27 16:20:44.813536", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [gpu : Sleep for a moment] ************************************************************************************************
Pausing for 5 seconds
(ctrl+C then 'C' = continue early, ctrl+C then 'A' = abort)
ok: [server1] => {"changed": false, "delta": 5, "echo": true, "rc": 0, "start": "2025-02-27 21:50:46.330373", "stderr": "", "stdout": "Paused for 5.0 seconds", "stop": "2025-02-27 21:50:51.335049", "user_input": ""}

TASK [gpu : Load dependent NVIDIA modules one by one] **************************************************************************
changed: [server1] => (item=nvidia) => {"ansible_loop_var": "item", "changed": true, "cmd": "modprobe nvidia", "delta": "0:00:00.005269", "end": "2025-02-27 16:20:58.098758", "item": "nvidia", "msg": "", "rc": 0, "start": "2025-02-27 16:20:58.093489", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [server1] => (item=nvidia_modeset) => {"ansible_loop_var": "item", "changed": true, "cmd": "modprobe nvidia_modeset", "delta": "0:00:00.005677", "end": "2025-02-27 16:21:05.763084", "item": "nvidia_modeset", "msg": "", "rc": 0, "start": "2025-02-27 16:21:05.757407", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [server1] => (item=nvidia_drm) => {"ansible_loop_var": "item", "changed": true, "cmd": "modprobe nvidia_drm", "delta": "0:00:00.075395", "end": "2025-02-27 16:21:13.424017", "item": "nvidia_drm", "msg": "", "rc": 0, "start": "2025-02-27 16:21:13.348622", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [server1] => (item=nvidia_uvm) => {"ansible_loop_var": "item", "changed": true, "cmd": "modprobe nvidia_uvm", "delta": "0:00:00.084936", "end": "2025-02-27 16:21:21.129417", "item": "nvidia_uvm", "msg": "", "rc": 0, "start": "2025-02-27 16:21:21.044481", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}
changed: [server1] => (item=gdrdrv) => {"ansible_loop_var": "item", "changed": true, "cmd": "modprobe gdrdrv", "delta": "0:00:00.008539", "end": "2025-02-27 16:21:28.534114", "item": "gdrdrv", "msg": "", "rc": 0, "start": "2025-02-27 16:21:28.525575", "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [gpu : Check if NVIDIA GPUs are PCIe] *************************************************************************************
ok: [server1] => {"changed": false, "cmd": "nvidia-smi -L", "delta": "0:00:00.085397", "end": "2025-02-27 16:21:36.278256", "msg": "", "rc": 0, "start": "2025-02-27 16:21:36.192859", "stderr": "", "stderr_lines": [], "stdout": "GPU 0: NVIDIA H100 PCIe (UUID: GPU-bdbb9c60-cb3f-3756-e847-97c2ba490ac8)\nGPU 1: NVIDIA H100 PCIe (UUID: GPU-264bcba1-c564-3380-77da-2c0a01a37e90)\nGPU 2: NVIDIA H100 PCIe (UUID: GPU-74e4ee32-858d-0f8d-f2ad-ba474a3d4819)\nGPU 3: NVIDIA H100 PCIe (UUID: GPU-fd5efc82-dde2-5451-7959-99dc0d46a6b3)\nGPU 4: NVIDIA H100 PCIe (UUID: GPU-b5d19501-13d9-ca5d-6b6a-8139f44d9bbd)\nGPU 5: NVIDIA H100 PCIe (UUID: GPU-c08c7e03-968e-a9d4-41df-6bd227312ccc)\nGPU 6: NVIDIA H100 PCIe (UUID: GPU-7b0ead78-b96a-ac40-c015-6e57d219eb1b)\nGPU 7: NVIDIA H100 PCIe (UUID: GPU-624baca6-99f9-1923-de58-c1c3e2127948)", "stdout_lines": ["GPU 0: NVIDIA H100 PCIe (UUID: GPU-bdbb9c60-cb3f-3756-e847-97c2ba490ac8)", "GPU 1: NVIDIA H100 PCIe (UUID: GPU-264bcba1-c564-3380-77da-2c0a01a37e90)", "GPU 2: NVIDIA H100 PCIe (UUID: GPU-74e4ee32-858d-0f8d-f2ad-ba474a3d4819)", "GPU 3: NVIDIA H100 PCIe (UUID: GPU-fd5efc82-dde2-5451-7959-99dc0d46a6b3)", "GPU 4: NVIDIA H100 PCIe (UUID: GPU-b5d19501-13d9-ca5d-6b6a-8139f44d9bbd)", "GPU 5: NVIDIA H100 PCIe (UUID: GPU-c08c7e03-968e-a9d4-41df-6bd227312ccc)", "GPU 6: NVIDIA H100 PCIe (UUID: GPU-7b0ead78-b96a-ac40-c015-6e57d219eb1b)", "GPU 7: NVIDIA H100 PCIe (UUID: GPU-624baca6-99f9-1923-de58-c1c3e2127948)"]}

TASK [gpu : Fail if the Nvidia GPUs are not initialized] ***********************************************************************
ok: [server1] => {"ansible_facts": {"has_passed": false}, "changed": false}

TASK [gpu : Set fact for PCIe GPUs] ********************************************************************************************
ok: [server1] => {"ansible_facts": {"has_pcie": true}, "changed": false}

TASK [gpu : Install and configure NVIDIA Fabric Manager] ***********************************************************************
skipping: [server1] => {"changed": false, "false_condition": "has_pcie is none", "skip_reason": "Conditional result was False"}

TASK [gpu : Install NVIDIA Container Toolkit and Runtime] **********************************************************************
changed: [server1] => {"cache_update_time": 1740673305, "cache_updated": true, "changed": true, "stderr": "", "stderr_lines": [], "stdout": "Reading package lists...\nBuilding dependency tree...\nReading state information...\nThe following additional packages will be installed:\n  libnvidia-container-tools libnvidia-container1 nvidia-container-toolkit-base\nThe following NEW packages will be installed:\n  libnvidia-container-tools libnvidia-container1 nvidia-container-runtime\n  nvidia-container-toolkit nvidia-container-toolkit-base\n0 upgraded, 5 newly installed, 0 to remove and 13 not upgraded.\nNeed to get 0 B/5817 kB of archives.\nAfter this operation, 27.7 MB of additional disk space will be used.\nSelecting previously unselected package libnvidia-container1:amd64.\r\n(Reading database ... \r(Reading database ... 5%\r(Reading database ... 10%\r(Reading database ... 15%\r(Reading database ... 20%\r(Reading database ... 25%\r(Reading database ... 30%\r(Reading database ... 35%\r(Reading database ... 40%\r(Reading database ... 45%\r(Reading database ... 50%\r(Reading database ... 55%\r(Reading database ... 60%\r(Reading database ... 65%\r(Reading database ... 70%\r(Reading database ... 75%\r(Reading database ... 80%\r(Reading database ... 85%\r(Reading database ... 90%\r(Reading database ... 95%\r(Reading database ... 100%\r(Reading database ... 197189 files and directories currently installed.)\r\nPreparing to unpack .../libnvidia-container1_1.17.4-1_amd64.deb ...\r\nUnpacking libnvidia-container1:amd64 (1.17.4-1) ...\r\nSelecting previously unselected package libnvidia-container-tools.\r\nPreparing to unpack .../libnvidia-container-tools_1.17.4-1_amd64.deb ...\r\nUnpacking libnvidia-container-tools (1.17.4-1) ...\r\nSelecting previously unselected package nvidia-container-toolkit-base.\r\nPreparing to unpack .../nvidia-container-toolkit-base_1.17.4-1_amd64.deb ...\r\nUnpacking nvidia-container-toolkit-base (1.17.4-1) ...\r\nSelecting previously unselected package nvidia-container-toolkit.\r\nPreparing to unpack .../nvidia-container-toolkit_1.17.4-1_amd64.deb ...\r\nUnpacking nvidia-container-toolkit (1.17.4-1) ...\r\nSelecting previously unselected package nvidia-container-runtime.\r\nPreparing to unpack .../nvidia-container-runtime_3.13.0-1_all.deb ...\r\nUnpacking nvidia-container-runtime (3.13.0-1) ...\r\nSetting up nvidia-container-toolkit-base (1.17.4-1) ...\r\nSetting up libnvidia-container1:amd64 (1.17.4-1) ...\r\nSetting up libnvidia-container-tools (1.17.4-1) ...\r\nSetting up nvidia-container-toolkit (1.17.4-1) ...\r\nSetting up nvidia-container-runtime (3.13.0-1) ...\r\nProcessing triggers for libc-bin (2.39-0ubuntu8.4) ...\r\n\nRunning kernel seems to be up-to-date.\n\nNo services need to be restarted.\n\nNo containers need to be restarted.\n\nNo user sessions are running outdated binaries.\n\nNo VM guests are running outdated hypervisor (qemu) binaries on this host.\n", "stdout_lines": ["Reading package lists...", "Building dependency tree...", "Reading state information...", "The following additional packages will be installed:", "  libnvidia-container-tools libnvidia-container1 nvidia-container-toolkit-base", "The following NEW packages will be installed:", "  libnvidia-container-tools libnvidia-container1 nvidia-container-runtime", "  nvidia-container-toolkit nvidia-container-toolkit-base", "0 upgraded, 5 newly installed, 0 to remove and 13 not upgraded.", "Need to get 0 B/5817 kB of archives.", "After this operation, 27.7 MB of additional disk space will be used.", "Selecting previously unselected package libnvidia-container1:amd64.", "(Reading database ... ", "(Reading database ... 5%", "(Reading database ... 10%", "(Reading database ... 15%", "(Reading database ... 20%", "(Reading database ... 25%", "(Reading database ... 30%", "(Reading database ... 35%", "(Reading database ... 40%", "(Reading database ... 45%", "(Reading database ... 50%", "(Reading database ... 55%", "(Reading database ... 60%", "(Reading database ... 65%", "(Reading database ... 70%", "(Reading database ... 75%", "(Reading database ... 80%", "(Reading database ... 85%", "(Reading database ... 90%", "(Reading database ... 95%", "(Reading database ... 100%", "(Reading database ... 197189 files and directories currently installed.)", "Preparing to unpack .../libnvidia-container1_1.17.4-1_amd64.deb ...", "Unpacking libnvidia-container1:amd64 (1.17.4-1) ...", "Selecting previously unselected package libnvidia-container-tools.", "Preparing to unpack .../libnvidia-container-tools_1.17.4-1_amd64.deb ...", "Unpacking libnvidia-container-tools (1.17.4-1) ...", "Selecting previously unselected package nvidia-container-toolkit-base.", "Preparing to unpack .../nvidia-container-toolkit-base_1.17.4-1_amd64.deb ...", "Unpacking nvidia-container-toolkit-base (1.17.4-1) ...", "Selecting previously unselected package nvidia-container-toolkit.", "Preparing to unpack .../nvidia-container-toolkit_1.17.4-1_amd64.deb ...", "Unpacking nvidia-container-toolkit (1.17.4-1) ...", "Selecting previously unselected package nvidia-container-runtime.", "Preparing to unpack .../nvidia-container-runtime_3.13.0-1_all.deb ...", "Unpacking nvidia-container-runtime (3.13.0-1) ...", "Setting up nvidia-container-toolkit-base (1.17.4-1) ...", "Setting up libnvidia-container1:amd64 (1.17.4-1) ...", "Setting up libnvidia-container-tools (1.17.4-1) ...", "Setting up nvidia-container-toolkit (1.17.4-1) ...", "Setting up nvidia-container-runtime (3.13.0-1) ...", "Processing triggers for libc-bin (2.39-0ubuntu8.4) ...", "", "Running kernel seems to be up-to-date.", "", "No services need to be restarted.", "", "No containers need to be restarted.", "", "No user sessions are running outdated binaries.", "", "No VM guests are running outdated hypervisor (qemu) binaries on this host."]}

TASK [gpu : Check if NVIDIA runtime configuration file exists] *****************************************************************
ok: [server1] => {"changed": false, "stat": {"atime": 1740656673.7703252, "attr_flags": "e", "attributes": ["extents"], "block_size": 4096, "blocks": 8, "charset": "us-ascii", "checksum": "0581fdd52630a2672eef60d09742cf4a62012020", "ctime": 1740673306.81179, "dev": 64769, "device_type": 0, "executable": false, "exists": true, "gid": 0, "gr_name": "root", "inode": 2589148, "isblk": false, "ischr": false, "isdir": false, "isfifo": false, "isgid": false, "islnk": false, "isreg": true, "issock": false, "isuid": false, "mimetype": "text/plain", "mode": "0644", "mtime": 1740673306.81179, "nlink": 1, "path": "/etc/nvidia-container-runtime/config.toml", "pw_name": "root", "readable": true, "rgrp": true, "roth": true, "rusr": true, "size": 1190, "uid": 0, "version": "3182625341", "wgrp": false, "woth": false, "writeable": true, "wusr": true, "xgrp": false, "xoth": false, "xusr": false}}

TASK [gpu : Take the backup of the existing file] ******************************************************************************
changed: [server1] => {"changed": true, "checksum": "0581fdd52630a2672eef60d09742cf4a62012020", "dest": "/etc/nvidia-container-runtime/config.toml_bk", "gid": 0, "group": "root", "md5sum": "bf792941869d6724854ada2d38d4a42e", "mode": "0644", "owner": "root", "size": 1190, "src": "/etc/nvidia-container-runtime/config.toml", "state": "file", "uid": 0}

TASK [gpu : Copy the container runtime config file] ****************************************************************************
changed: [server1] => {"changed": true, "checksum": "e892fe974621509f07ca7058a81eb4e4f15d6e2a", "dest": "/etc/nvidia-container-runtime/config.toml", "gid": 0, "group": "root", "md5sum": "6205d48021f6f2f2bf3d04986feb1e0f", "mode": "0644", "owner": "root", "size": 1133, "src": "/root/.ansible/tmp/ansible-tmp-1740673325.232827-70980-108820933177952/.source.toml", "state": "file", "uid": 0}

TASK [gpu : Check if nvidia parameters are present in config.toml] *************************************************************
ok: [server1] => {"changed": false, "cmd": "result1=$(grep -E \"^accept-nvidia-visible-devices-as-volume-mounts = true\" /etc/nvidia-container-runtime/config.toml > /dev/null; echo $?)\nresult2=$(grep -E \"^accept-nvidia-visible-devices-envvar-when-unprivileged = false\" /etc/nvidia-container-runtime/config.toml > /dev/null; echo $?)\necho \"{\\\"volume_param\\\": $result1, \\\"envvar_param\\\": $result2}\"\n", "delta": "0:00:00.007297", "end": "2025-02-27 16:22:28.692585", "msg": "", "rc": 0, "start": "2025-02-27 16:22:28.685288", "stderr": "", "stderr_lines": [], "stdout": "{\"volume_param\": 0, \"envvar_param\": 0}", "stdout_lines": ["{\"volume_param\": 0, \"envvar_param\": 0}"]}

TASK [gpu : Set facts about nvidia parameters] *********************************************************************************
ok: [server1] => {"ansible_facts": {"nvidia_envvar_param_present": true, "nvidia_volume_param_present": true}, "changed": false}

TASK [gpu : Fail if nvidia parameters are missing] *****************************************************************************
skipping: [server1] => {"changed": false, "false_condition": "not (nvidia_volume_param_present and nvidia_envvar_param_present)", "skip_reason": "Conditional result was False"}

TASK [gpu : Create installation directory] *************************************************************************************
changed: [server1] => {"changed": true, "gid": 0, "group": "root", "mode": "0755", "owner": "root", "path": "/root/ansible.tmp/", "size": 4096, "state": "directory", "uid": 0}

TASK [gpu : Create NVIDIA RuntimeClass manifest] *******************************************************************************
changed: [server1] => {"changed": true, "checksum": "49d907d1e756812b63f78e9258a21d062ab9f1d1", "dest": "/root/ansible.tmp//nvidia-runtime-class.yml", "gid": 0, "group": "root", "md5sum": "c620e0fe61f2ef33e26c7c849d5dd4a7", "mode": "0644", "owner": "root", "size": 87, "src": "/root/.ansible/tmp/ansible-tmp-1740673358.455433-71150-167764837964086/.source.yml", "state": "file", "uid": 0}

TASK [gpu : Apply NVIDIA RuntimeClass] *****************************************************************************************
ok: [server1] => {"changed": false, "method": "update", "result": {"apiVersion": "node.k8s.io/v1", "handler": "nvidia", "kind": "RuntimeClass", "metadata": {"annotations": {"kubectl.kubernetes.io/last-applied-configuration": "{\"apiVersion\":\"node.k8s.io/v1\",\"handler\":\"nvidia\",\"kind\":\"RuntimeClass\",\"metadata\":{\"annotations\":{},\"name\":\"nvidia\"}}\n", "objectset.rio.cattle.io/applied": "H4sIAAAAAAAA/4yQvW7rMAyFX+XizIovHMOJI6BD0bFbh+6URNeqbSowFRdF4HcvhGbo0p+R+MiPh7yCzvGZF41JYCEpcDV2WsX0f61hMJCEiZeC1hgiwWCMEmDxdJEcZ36YSBUGM2cKlAn2ChJJmXJMoqVM7pV9Vs7VElPlKeeJy4JYNDDf8vQmvOxe1hEWY6NfyFqbf49Rwt19CEl+VQjNDIvlM7H+qV/P5MvQeHG803fNPGMzmMjx9ONVA+kAi/a4b2rHdDq0ne/3be8D+X3T1749dC35o3O+P3VNkd7y3T68bR8BAAD///Uj4MeVAQAA", "objectset.rio.cattle.io/id": "", "objectset.rio.cattle.io/owner-gvk": "k3s.cattle.io/v1, Kind=Addon", "objectset.rio.cattle.io/owner-name": "runtimes", "objectset.rio.cattle.io/owner-namespace": "kube-system"}, "creationTimestamp": "2025-02-26T17:31:47Z", "labels": {"objectset.rio.cattle.io/hash": "57231bea9658cf25fcdac23f1c5685ac7bbcf983"}, "managedFields": [{"apiVersion": "node.k8s.io/v1", "fieldsType": "FieldsV1", "fieldsV1": {"f:handler": {}, "f:metadata": {"f:annotations": {".": {}, "f:objectset.rio.cattle.io/applied": {}, "f:objectset.rio.cattle.io/id": {}, "f:objectset.rio.cattle.io/owner-gvk": {}, "f:objectset.rio.cattle.io/owner-name": {}, "f:objectset.rio.cattle.io/owner-namespace": {}}, "f:labels": {".": {}, "f:objectset.rio.cattle.io/hash": {}}}}, "manager": "deploy@node1", "operation": "Update", "time": "2025-02-26T17:31:47Z"}, {"apiVersion": "node.k8s.io/v1", "fieldsType": "FieldsV1", "fieldsV1": {"f:metadata": {"f:annotations": {"f:kubectl.kubernetes.io/last-applied-configuration": {}}}}, "manager": "kubectl-client-side-apply", "operation": "Update", "time": "2025-02-27T10:31:17Z"}], "name": "nvidia", "resourceVersion": "19711", "uid": "9ee6aa82-430b-40a5-964c-dbfe78bfdc1d"}}}

TASK [gpu : Label GPU nodes for NVIDIA support] ********************************************************************************
ok: [server1] => (item=node1) => {"ansible_loop_var": "item", "changed": false, "item": "node1", "method": "update", "result": {"apiVersion": "v1", "kind": "Node", "metadata": {"annotations": {"alpha.kubernetes.io/provided-node-ip": "10.0.1.97", "flannel.alpha.coreos.com/backend-data": "{\"VNI\":1,\"VtepMAC\":\"d2:19:ce:bc:8b:20\"}", "flannel.alpha.coreos.com/backend-type": "vxlan", "flannel.alpha.coreos.com/kube-subnet-manager": "true", "flannel.alpha.coreos.com/public-ip": "10.0.1.97", "k3s.io/hostname": "node1", "k3s.io/internal-ip": "10.0.1.97", "k3s.io/node-args": "[\"server\"]", "k3s.io/node-config-hash": "MLFMUCBMRVINLJJKSG32TOUFWB4CN55GMSNY25AZPESQXZCYRN2A====", "k3s.io/node-env": "{}", "node.alpha.kubernetes.io/ttl": "0", "volumes.kubernetes.io/controller-managed-attach-detach": "true"}, "creationTimestamp": "2025-02-26T17:31:44Z", "finalizers": ["wrangler.cattle.io/node"], "labels": {"allow-nvdp": "true", "beta.kubernetes.io/arch": "amd64", "beta.kubernetes.io/instance-type": "k3s", "beta.kubernetes.io/os": "linux", "kubernetes.io/arch": "amd64", "kubernetes.io/hostname": "node1", "kubernetes.io/os": "linux", "node-role.kubernetes.io/control-plane": "true", "node-role.kubernetes.io/master": "true", "node.kubernetes.io/instance-type": "k3s", "nvidia.com/gpu.present": "true"}, "managedFields": [{"apiVersion": "v1", "fieldsType": "FieldsV1", "fieldsV1": {"f:metadata": {"f:finalizers": {".": {}, "v:\"wrangler.cattle.io/node\"": {}}, "f:labels": {"f:node-role.kubernetes.io/control-plane": {}, "f:node-role.kubernetes.io/master": {}}}}, "manager": "k3s-supervisor@node1", "operation": "Update", "time": "2025-02-26T17:31:44Z"}, {"apiVersion": "v1", "fieldsType": "FieldsV1", "fieldsV1": {"f:metadata": {"f:annotations": {".": {}, "f:alpha.kubernetes.io/provided-node-ip": {}, "f:k3s.io/hostname": {}, "f:k3s.io/internal-ip": {}, "f:k3s.io/node-args": {}, "f:k3s.io/node-config-hash": {}, "f:k3s.io/node-env": {}, "f:node.alpha.kubernetes.io/ttl": {}, "f:volumes.kubernetes.io/controller-managed-attach-detach": {}}, "f:labels": {".": {}, "f:beta.kubernetes.io/arch": {}, "f:beta.kubernetes.io/instance-type": {}, "f:beta.kubernetes.io/os": {}, "f:kubernetes.io/arch": {}, "f:kubernetes.io/hostname": {}, "f:kubernetes.io/os": {}, "f:node.kubernetes.io/instance-type": {}}}, "f:spec": {"f:podCIDR": {}, "f:podCIDRs": {".": {}, "v:\"10.42.0.0/24\"": {}}, "f:providerID": {}}}, "manager": "k3s", "operation": "Update", "time": "2025-02-26T17:31:49Z"}, {"apiVersion": "v1", "fieldsType": "FieldsV1", "fieldsV1": {"f:metadata": {"f:labels": {"f:allow-nvdp": {}, "f:nvidia.com/gpu.present": {}}}}, "manager": "kubectl-label", "operation": "Update", "time": "2025-02-27T06:56:11Z"}, {"apiVersion": "v1", "fieldsType": "FieldsV1", "fieldsV1": {"f:metadata": {"f:annotations": {"f:flannel.alpha.coreos.com/backend-data": {}, "f:flannel.alpha.coreos.com/backend-type": {}, "f:flannel.alpha.coreos.com/kube-subnet-manager": {}, "f:flannel.alpha.coreos.com/public-ip": {}}}, "f:status": {"f:allocatable": {"f:memory": {}, "f:nvidia.com/gpu": {}}, "f:capacity": {"f:memory": {}, "f:nvidia.com/gpu": {}}, "f:conditions": {"k:{\"type\":\"DiskPressure\"}": {"f:lastHeartbeatTime": {}}, "k:{\"type\":\"MemoryPressure\"}": {"f:lastHeartbeatTime": {}}, "k:{\"type\":\"PIDPressure\"}": {"f:lastHeartbeatTime": {}}, "k:{\"type\":\"Ready\"}": {"f:lastHeartbeatTime": {}, "f:message": {}, "f:reason": {}, "f:status": {}}}, "f:images": {}, "f:nodeInfo": {"f:bootID": {}, "f:kernelVersion": {}}}}, "manager": "k3s", "operation": "Update", "subresource": "status", "time": "2025-02-27T16:21:03Z"}], "name": "node1", "resourceVersion": "26238", "uid": "aa21ac1c-32e5-44a3-96f1-a45c64aae739"}, "spec": {"podCIDR": "10.42.0.0/24", "podCIDRs": ["10.42.0.0/24"], "providerID": "k3s://node1"}, "status": {"addresses": [{"address": "10.0.1.97", "type": "InternalIP"}, {"address": "node1", "type": "Hostname"}], "allocatable": {"cpu": "252", "ephemeral-storage": "6524650321719", "hugepages-1Gi": "0", "hugepages-2Mi": "0", "memory": "1486144736Ki", "nvidia.com/gpu": "0", "pods": "110"}, "capacity": {"cpu": "252", "ephemeral-storage": "6707082984Ki", "hugepages-1Gi": "0", "hugepages-2Mi": "0", "memory": "1486144736Ki", "nvidia.com/gpu": "0", "pods": "110"}, "conditions": [{"lastHeartbeatTime": "2025-02-27T16:21:03Z", "lastTransitionTime": "2025-02-26T17:31:44Z", "message": "kubelet has sufficient memory available", "reason": "KubeletHasSufficientMemory", "status": "False", "type": "MemoryPressure"}, {"lastHeartbeatTime": "2025-02-27T16:21:03Z", "lastTransitionTime": "2025-02-26T17:31:44Z", "message": "kubelet has no disk pressure", "reason": "KubeletHasNoDiskPressure", "status": "False", "type": "DiskPressure"}, {"lastHeartbeatTime": "2025-02-27T16:21:03Z", "lastTransitionTime": "2025-02-26T17:31:44Z", "message": "kubelet has sufficient PID available", "reason": "KubeletHasSufficientPID", "status": "False", "type": "PIDPressure"}, {"lastHeartbeatTime": "2025-02-27T16:21:03Z", "lastTransitionTime": "2025-02-26T17:31:44Z", "message": "kubelet is posting ready status", "reason": "KubeletReady", "status": "True", "type": "Ready"}], "daemonEndpoints": {"kubeletEndpoint": {"Port": 10250}}, "images": [{"names": ["nvcr.io/nvidia/k8s-device-plugin@sha256:7089559ce6153018806857f5049085bae15b3bf6f1c8bd19d8b12f707d087dea", "nvcr.io/nvidia/k8s-device-plugin:v0.17.0"], "sizeBytes": 187560257}, {"names": ["nvcr.io/nvidia/k8s-device-plugin@sha256:ed39e22c8b71343fb996737741a99da88ce6c75dd83b5c520e0b3d8e8a884c47", "nvcr.io/nvidia/k8s-device-plugin:v0.16.2"], "sizeBytes": 126081487}, {"names": ["docker.io/rancher/klipper-helm@sha256:73ff7ef399717ba8339559054557bd427bdafb47db112165a8c0c358d1ca0283", "docker.io/rancher/klipper-helm:v0.9.3-build20241008"], "sizeBytes": 70496341}, {"names": ["docker.io/rancher/mirrored-library-traefik@sha256:25df7bff0b414867f16a74c571c0dc84920404e45cc7780976cec77809230e09", "docker.io/rancher/mirrored-library-traefik:2.11.18"], "sizeBytes": 49449055}, {"names": ["docker.io/rancher/mirrored-coredns-coredns@sha256:82979ddf442c593027a57239ad90616deb874e90c365d1a96ad508c2104bdea5", "docker.io/rancher/mirrored-coredns-coredns:1.12.0"], "sizeBytes": 20938299}, {"names": ["docker.io/rancher/mirrored-metrics-server@sha256:dccf8474fb910fef261d31d9483d7e4c1df7b86cf4d638fb6a7d7c88bd51600a", "docker.io/rancher/mirrored-metrics-server:v0.7.2"], "sizeBytes": 19494186}, {"names": ["docker.io/rancher/local-path-provisioner@sha256:9b914881170048f80ae9302f36e5b99b4a6b18af73a38adc1c66d12f65d360be", "docker.io/rancher/local-path-provisioner:v0.0.30"], "sizeBytes": 18584855}, {"names": ["docker.io/rancher/klipper-lb@sha256:dd380f5d89a52f2a07853ff17a6048f805c1f8113b50578f3efc3efb9bcf670a", "docker.io/rancher/klipper-lb:v0.4.9"], "sizeBytes": 4990278}, {"names": ["docker.io/rancher/mirrored-pause@sha256:74c4244427b7312c5b901fe0f67cbc53683d06f4f24c6faee65d4182bf0fa893", "docker.io/rancher/mirrored-pause:3.6"], "sizeBytes": 301463}], "nodeInfo": {"architecture": "amd64", "bootID": "b730a115-4e66-4173-9ccd-39f7a63b1833", "containerRuntimeVersion": "containerd://1.7.23-k3s2", "kernelVersion": "6.8.0-54-generic", "kubeProxyVersion": "v1.31.5+k3s1", "kubeletVersion": "v1.31.5+k3s1", "machineID": "d9372db8946f472f8787a2478dce7f44", "operatingSystem": "linux", "osImage": "Ubuntu 24.04.2 LTS", "systemUUID": "27d7c14b-409d-48c2-9263-b9ce3e52a6b5"}}}}

TASK [gpu : Add NVIDIA Device Plugin Helm repository] **************************************************************************
ok: [server1] => {"changed": false, "repo_name": "nvdp", "repo_url": "https://nvidia.github.io/k8s-device-plugin"}

TASK [gpu : Update Helm repositories] ******************************************************************************************
changed: [server1] => {"changed": true, "cmd": ["helm", "repo", "update"], "delta": "0:00:00.102511", "end": "2025-02-27 16:23:24.221977", "msg": "", "rc": 0, "start": "2025-02-27 16:23:24.119466", "stderr": "", "stderr_lines": [], "stdout": "Hang tight while we grab the latest from your chart repositories...\n...Successfully got an update from the \"nvdp\" chart repository\nUpdate Complete. ⎈Happy Helming!⎈", "stdout_lines": ["Hang tight while we grab the latest from your chart repositories...", "...Successfully got an update from the \"nvdp\" chart repository", "Update Complete. ⎈Happy Helming!⎈"]}

TASK [gpu : Check for required GPU node labels] ********************************************************************************
ok: [server1] => {"changed": false, "cmd": "kubectl get nodes -o json | jq -r '.items[] | {\n  \"name\": .metadata.name,\n  \"has_allow_nvdp\": (.metadata.labels.\"allow-nvdp\" == \"true\"),\n  \"has_gpu_present\": (.metadata.labels.\"nvidia.com/gpu.present\" == \"true\")\n} | tostring'\n", "delta": "0:00:00.113273", "end": "2025-02-27 16:23:31.691046", "msg": "", "rc": 0, "start": "2025-02-27 16:23:31.577773", "stderr": "", "stderr_lines": [], "stdout": "{\"name\":\"node1\",\"has_allow_nvdp\":true,\"has_gpu_present\":true}", "stdout_lines": ["{\"name\":\"node1\",\"has_allow_nvdp\":true,\"has_gpu_present\":true}"]}

TASK [gpu : Parse node label results] ******************************************************************************************
ok: [server1] => {"ansible_facts": {"parsed_node_labels": [{"has_allow_nvdp": true, "has_gpu_present": true, "name": "node1"}]}, "changed": false}

TASK [gpu : Display nodes missing required labels] *****************************************************************************
skipping: [server1] => (item={'name': 'node1', 'has_allow_nvdp': True, 'has_gpu_present': True})  => {"ansible_loop_var": "item", "false_condition": "not (item.has_allow_nvdp and item.has_gpu_present)", "item": {"has_allow_nvdp": true, "has_gpu_present": true, "name": "node1"}}
skipping: [server1] => {"msg": "All items skipped"}

TASK [gpu : Fail if required labels are missing] *******************************************************************************
skipping: [server1] => (item={'name': 'node1', 'has_allow_nvdp': True, 'has_gpu_present': True})  => {"ansible_loop_var": "item", "changed": false, "false_condition": "not (item.has_allow_nvdp and item.has_gpu_present)", "item": {"has_allow_nvdp": true, "has_gpu_present": true, "name": "node1"}, "skip_reason": "Conditional result was False"}
skipping: [server1] => {"changed": false, "msg": "All items skipped"}

TASK [gpu : Check if any node has all required labels] *************************************************************************
ok: [server1] => (item={'name': 'node1', 'has_allow_nvdp': True, 'has_gpu_present': True}) => {"ansible_facts": {"labels_ready": true}, "ansible_loop_var": "item", "changed": false, "item": {"has_allow_nvdp": true, "has_gpu_present": true, "name": "node1"}}

TASK [gpu : Install NVIDIA Device Plugin] **************************************************************************************
[WARNING]: The default idempotency check can fail to report changes in certain cases. Install helm diff >= 3.4.1 for better
results.
ok: [server1] => {"changed": false, "command": "/usr/local/bin/helm --version=0.17.0", "status": {"app_version": "0.17.0", "chart": "nvidia-device-plugin-0.17.0", "name": "nvdp", "namespace": "nvidia-device-plugin", "revision": "2", "status": "deployed", "updated": "2025-02-27 09:37:24.360837176 +0000 UTC", "values": {"deviceListStrategy": "volume-mounts", "nodeSelector": {"allow-nvdp": "true"}, "runtimeClassName": "nvidia"}}, "stderr": "", "stderr_lines": [], "stdout": "", "stdout_lines": []}

TASK [gpu : Create configuration to disable automatic updates] *****************************************************************
ok: [server1] => {"changed": false, "checksum": "661401b3cbecb901a4443b988081b77e7cd4a673", "dest": "/etc/apt/apt.conf.d/20auto-upgrades", "gid": 0, "group": "root", "mode": "0644", "owner": "root", "path": "/etc/apt/apt.conf.d/20auto-upgrades", "size": 82, "state": "file", "uid": 0}

TASK [gpu : Remove unattended-upgrades package] ********************************************************************************
ok: [server1] => {"changed": false}

PLAY RECAP *********************************************************************************************************************
server1            : ok=39   changed=11   unreachable=0    failed=0    skipped=5    rescued=0    ignored=0

```
