---
- name: Load rook-ceph values from file
  set_fact:
    rook_ceph_values: "{{ lookup('file', role_path + '/rook-ceph-cluster.values.yml') | from_yaml }}"

- name: Set storage class name from rook-ceph values
  set_fact:
    rook_ceph_storage_class: "{{ rook_ceph_values.cephBlockPools[0].storageClass.name }}"

- name: Label the storage class with akash.network=true
  shell: >
    kubectl label storageclass {{ rook_ceph_storage_class }} akash.network=true --overwrite
  register: label_result
  changed_when: "'labeled' in label_result.stdout or 'configured' in label_result.stdout"
  failed_when: label_result.rc != 0
  delegate_to: localhost
  run_once: true
